<!DOCTYPE html>
<html>
<head>
<title>Growth Chart Generator</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family: Arial;
  background:#f6d3ef;
  text-align:center;
  padding:20px;
}
textarea,input{
  width:90%;
  margin:6px;
  padding:8px;
}
button{
  padding:10px 20px;
  font-size:16px;
  background:#7a2d91;
  color:white;
  border:none;
  cursor:pointer;
  margin:10px;
}
canvas{
  background:white;
  margin-top:20px;
  padding:10px;
}
</style>
</head>

<body>

<h2>Percentile Chart Generator</h2>

<input id="title" placeholder="Chart Title">
<input id="ylabel" placeholder="Y Axis Label">

<h3>Ages (X axis)</h3>
<textarea id="ages">5,6,7,8,9,10,11,12,13,14,15,16,17</textarea>

<h3>Percentile Data</h3>
<textarea id="p3">47,49,51,53,55,57,59,61,63,65,66,67,68</textarea>
<textarea id="p10"></textarea>
<textarea id="p25"></textarea>
<textarea id="p50"></textarea>
<textarea id="p70"></textarea>
<textarea id="p85"></textarea>
<textarea id="p95"></textarea>

<br>
<button onclick="generateChart()">Generate Chart</button>
<button onclick="downloadChart()">Download PNG</button>

<canvas id="chart" width="900" height="500"></canvas>

<script>
let chart;

function getArray(id){
  return document.getElementById(id).value.split(",").map(Number);
}

function dataset(label,data,color,width=2){
  return {
    label:label,
    data:data,
    borderColor:color,
    fill:false,
    tension:0.4,
    borderWidth:width,
    pointRadius:0
  }
}

function generateChart(){

  const ages = getArray("ages");

  const dataSets = [
    dataset("P3",getArray("p3"),"#000"),
    dataset("P10",getArray("p10"),"#000"),
    dataset("P25",getArray("p25"),"#000"),
    dataset("P50",getArray("p50"),"#e60000",3),
    dataset("P70",getArray("p70"),"#000"),
    dataset("P85",getArray("p85"),"#000"),
    dataset("P95",getArray("p95"),"#000"),
  ];

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("chart"), {
    type:"line",
    data:{ labels:ages, datasets:dataSets },
    options:{
      responsive:true,
      plugins:{
        legend:{display:false},
        title:{
          display:true,
          text:document.getElementById("title").value,
          font:{size:20}
        }
      },
      scales:{
        x:{
          title:{display:true,text:"Age (Years)"},
          grid:{color:"#888"}
        },

        y:{
          title:{display:true,text:document.getElementById("ylabel").value},
          grid:{color:"#888"}
        }
      },
      layout:{
        padding:{ right:80 }
      }
    },
    plugins:[{
      id:"endLabels",
      afterDraw(chart){
        const ctx = chart.ctx;
        const pLabels = ["P3","P10","P25","P50","P70","P85","P95"];
        chart.data.datasets.forEach((ds, i) => {
          const meta = chart.getDatasetMeta(i);
          const lastPoint = meta.data[meta.data.length - 1];
          if(!lastPoint) return;
          const x = lastPoint.x;
          const y = lastPoint.y;
          const val = ds.data[ds.data.length - 1];
          ctx.save();
          ctx.font = "bold 11px Arial";
          ctx.fillStyle = ds.borderColor;
          ctx.textBaseline = "middle";
          ctx.fillText(pLabels[i] + " (" + val + ")", x + 8, y);
          ctx.restore();
        });
      }
    }]
  });
}

function downloadChart(){
  const link=document.createElement("a");
  link.download="chart.png";
  link.href=document.getElementById("chart").toDataURL();
  link.click();
}
</script>

</body>
</html>
