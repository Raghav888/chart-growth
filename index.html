<!DOCTYPE html>
<html>

<head>
    <title>IAP Growth Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="growth-data.js"></script>

    <style>
        body {
            font-family: Arial;
            background: #f4f6f8;
            text-align: center
        }

        .container {
            max-width: 420px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px
        }

        input,
        select {
            width: 90%;
            padding: 8px;
            margin: 6px;
            border: 1px solid #ccc
        }

        button {
            padding: 10px 20px;
            background: #0077b6;
            color: white;
            border: none;
            margin: 10px;
            border-radius: 5px
        }

        canvas {
            margin-top: 30px;
            background: white;
            max-width: 1500px;
        }


        .chart-title {
            margin-top: 40px;
            color: #023e8a
        }

        .result {
            font-weight: bold;
            color: #d90429;
            margin: 5px
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>IAP Growth Charts</h2>

        <select id="gender">
            <option value="boy">Boy</option>
            <option value="girl">Girl</option>
        </select>

        <select id="age"></select>

        <input id="height" type="number" placeholder="Height (cm)" min="80" max="200">
        <input id="weight" type="number" placeholder="Weight (kg)" min="10" max="120">
        <input id="waist" type="number" placeholder="Waist (cm)" min="40" max="120">

        <button onclick="generate()">Generate Charts</button>
    </div>

    <h3 class="chart-title">Height-for-Age Percentile</h3>
    <p id="heightResult" class="result"></p>
    <canvas id="heightChart"></canvas>

    <h3 class="chart-title">Weight-for-Age Percentile</h3>
    <p id="weightResult" class="result"></p>
    <canvas id="weightChart"></canvas>

    <h3 class="chart-title">BMI-for-Age Percentile</h3>
    <p id="bmiResult" class="result"></p>
    <canvas id="bmiChart"></canvas>

    <h3 class="chart-title">Waist Circumference Percentile</h3>
    <p id="waistResult" class="result"></p>
    <canvas id="waistChart"></canvas>

    <script>
        let charts = [];

        /* populate age dropdown */
        AGES.forEach(a => {
            const op = document.createElement("option");
            op.value = a;
            op.innerText = a + " years";
            age.appendChild(op);
        });

        /* Right-side percentile labels */
        const rightLabelPlugin = {
            id: 'rightLabel',
            afterDatasetsDraw(chart) {
                const { ctx, chartArea: { right } } = chart;
                ctx.font = "bold 12px Arial";
                chart.data.datasets.forEach((ds) => {
                    if (ds.label === "Child") return;
                    const meta = chart.getDatasetMeta(chart.data.datasets.indexOf(ds));
                    if (!meta.data.length) return;
                    const last = meta.data[meta.data.length - 1];
                    ctx.fillText(ds.label, right + 8, last.y);
                });
            }
        };

        /* Draw chart */
        function drawChart(id, curves, percentiles, value, age, label, min, max) {
            const child = AGES.map(a => a == age ? value : null);

            charts.push(new Chart(document.getElementById(id), {
                type: 'line',
                data: {
                    labels: AGES,
                    datasets: [
                        ...curves.map((c, i) => ({
                            label: percentiles[i],
                            data: c,
                            borderColor: "#000",
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: .4
                        })),
                        {
                            label: "Child",
                            data: child,
                            borderColor: "blue",
                            backgroundColor: "blue",
                            pointBackgroundColor: "blue",
                            pointBorderColor: "white",
                            pointBorderWidth: 2,
                            pointRadius: 7,
                            pointHoverRadius: 7,
                            showLine: false,
                            spanGaps: true
                        }

                    ]
                },
                options: {
                    layout: { padding: { right: 90 } },
                    plugins: { legend: { display: false } },
                    scales: { y: { min, max, title: { display: true, text: label } } }
                },
                plugins: [rightLabelPlugin]
            }));
        }

        /* Percentile text */
        function getPercentileText(value, curves, ageIndex, percentiles) {
            if (!curves.length) return "No data available";

            if (value < curves[0][ageIndex])
                return "Below " + percentiles[0] + "th percentile";

            for (let i = 0; i < curves.length - 1; i++) {
                if (value >= curves[i][ageIndex] && value < curves[i + 1][ageIndex])
                    return percentiles[i] + "–" + percentiles[i + 1] + " percentile";
            }

            return "Above " + percentiles[percentiles.length - 1] + "th percentile";
        }

        /* Generate charts */
        function generate() {

            const gender = document.getElementById("gender").value;
            const age = parseFloat(document.getElementById("age").value);
            const height = parseFloat(document.getElementById("height").value);
            const weight = parseFloat(document.getElementById("weight").value);
            const waist = parseFloat(document.getElementById("waist").value);

            /* Input validation */
            if (height < 80 || height > 200) return alert("Enter valid height (80–200 cm)");
            if (weight < 10 || weight > 120) return alert("Enter valid weight (10–120 kg)");
            if (waist < 40 || waist > 120) return alert("Enter valid waist (40–120 cm)");

            charts.forEach(c => c.destroy());
            charts = [];

            const data = GROWTH_DATA[gender];
            const bmi = Number((weight / ((height / 100) ** 2)).toFixed(1));

            const ageIndex = AGES.indexOf(age);

            /* Percentile results */
            heightResult.innerText = "Child is in " + getPercentileText(height, data.height, ageIndex, PERCENTILES_HW);
            weightResult.innerText = "Child is in " + getPercentileText(weight, data.weight, ageIndex, PERCENTILES_HW);
            bmiResult.innerText = "Child is in " + getPercentileText(bmi, data.bmi, ageIndex, PERCENTILES_BMI);
            waistResult.innerText = "Child is in " + getPercentileText(waist, data.waist, ageIndex, PERCENTILES_WAIST);

            /* Draw charts */
            drawChart("heightChart", data.height, PERCENTILES_HW, height, age, "Height (cm)", 95, 195);
            drawChart("weightChart", data.weight, PERCENTILES_HW, weight, age, "Weight (kg)", 10, 90);
            drawChart("bmiChart", data.bmi, PERCENTILES_BMI, bmi, age, "BMI", 12, 40);
            drawChart("waistChart", data.waist, PERCENTILES_WAIST, waist, age, "Waist (cm)", 40, 110);
        }
    </script>

</body>

</html>


